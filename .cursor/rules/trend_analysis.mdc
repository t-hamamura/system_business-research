# トレンド分析ルール（v2.0: 安全機能強化版）

## 安全なファイル名変換関数
```python
import re
import unicodedata

def safe_filename(text, max_length=80):
    """
    ファイルシステムで安全な名前に変換
    """
    # NFKC正規化（全角→半角変換含む）
    text = unicodedata.normalize('NFKC', text)
    
    # 英数字、ひらがな、カタカナ、漢字、ハイフン、アンダースコアのみ許可
    safe_text = re.sub(r'[^\w\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF\-]', '_', text)
    
    # 連続するアンダースコアを1つに
    safe_text = re.sub(r'_+', '_', safe_text)
    
    # 先頭末尾のアンダースコア削除
    safe_text = safe_text.strip('_')
    
    # 長さ制限
    if len(safe_text) > max_length:
        safe_text = safe_text[:max_length]
    
    # 空文字列の場合はデフォルト値
    return safe_text or "unknown"
```

## トリガー条件
「トレンド調査」「業界トレンド」「トレンド分析」「将来予測」「技術トレンド」のいずれかが入力された場合

## 実行手順

### ステップ1: 対象確認・スコープ設定
- ユーザーに調査対象の業界・テーマを確認
- 例: 「どちらの領域のトレンド分析を実施いたしますか？（例：AI、フィンテック、サステナビリティ等）」
- 分析期間の確認：
  - 短期トレンド（6ヶ月-1年）
  - 中期トレンド（1-3年）
  - 長期トレンド（3-10年）
- 分析観点の確認：
  - 技術トレンド
  - 市場トレンド
  - 社会トレンド
  - 規制・政策トレンド

### ステップ2: 日時フォルダ作成
現在日時を取得し、適切なフォルダ構造を作成：
```
Flow/YYYYMM/YYYY-MM-DD/[案件名]/
```

### ステップ3: 情報収集（5回のweb_search）
以下の順序でトレンド情報を収集：

#### 第1段階：並列基本検索（3本同時）
1. **現在のトレンド**: "[対象] トレンド 最新動向 2024 2025"
2. **技術革新**: "[対象] 技術革新 イノベーション 新技術 最新"
3. **将来予測**: "[対象] 将来予測 予測 展望 2025 2030"

#### 第2段階：深掘り分析（2本順次）
4. **専門機関予測**: "[対象] ガートナー IDC 調査会社 予測 最新"
5. **海外動向**: "[対象] 海外 グローバル 動向 米国 欧州 最新"

### ステップ4: トレンド分析フレームワーク適用
収集した情報を以下の観点で分析：

#### STEEP分析
- **Social（社会）**: 社会変化・人口動態・ライフスタイル変化
- **Technological（技術）**: 技術革新・デジタル化・自動化
- **Economic（経済）**: 経済状況・市場構造・ビジネスモデル変化
- **Environmental（環境）**: 環境問題・サステナビリティ・気候変動
- **Political（政治・法規制）**: 政策変更・規制強化・国際情勢

#### ガートナーハイプサイクル的分析
- **黎明期**: 技術の出現・初期の過度な期待
- **過度な期待のピーク**: メディア注目・投資集中
- **幻滅の谷**: 現実とのギャップ・失望・淘汰
- **啓発の坂**: 実用的応用・成熟化
- **生産性の台地**: 主流採用・安定成長

#### S字カーブ分析
- **導入期**: 緩やかな成長・早期採用者
- **成長期**: 急速な拡大・主流市場への浸透
- **成熟期**: 成長鈍化・市場飽和・最適化

### ステップ5: トレンドドライバー分析
各トレンドの背景要因を特定：
- **技術進歩**: AI、IoT、5G、量子コンピュータ等
- **社会変化**: 少子高齢化、都市化、価値観の変化
- **経済要因**: グローバル化、デジタル化、サーキュラーエコノミー
- **規制変化**: プライバシー保護、ESG、脱炭素
- **パンデミック影響**: リモートワーク、デジタル変革加速

### ステップ6: 影響度・重要度評価
各トレンドについて：
- **影響度**: 市場・産業への影響の大きさ
- **確実性**: 実現可能性・予測精度
- **時間軸**: 影響が顕在化するタイミング
- **対応必要性**: 企業として対応すべき優先度

### ステップ7: 機会・脅威分析
- **機会**: 新市場創出・効率化・差別化
- **脅威**: 既存事業への影響・競争激化・規制リスク
- **不確実性**: 予測困難な変化・黒鳥的事象

### ステップ8: 信頼度評価
各情報源について：
- 予測機関の権威性・実績評価
- データの根拠・調査手法の確認
- 複数ソースでの整合性確認
- 時系列での予測精度検証
- 引用抜粋の作成（25語以内）

### ステップ9: レポート生成
templates/trend_analysis_template.mdを基に以下の構造でレポート作成：

```
# トレンド分析レポート：[対象領域名]

## 情報品質サマリー
**情報源数**: X個 | **平均発行年**: YYYY.M | **信頼度分布**: A級X個・B級X個・C級X個

## エグゼクティブサマリー
[3-4行での要約]

## 主要ファインディング
- [重要な発見事項1]
- [重要な発見事項2]
- [重要な発見事項3]

## 現在の主要トレンド
### トレンド1: [トレンド名]
### トレンド2: [トレンド名]
### トレンド3: [トレンド名]

## STEEP分析
### Social（社会変化）
### Technological（技術革新）
### Economic（経済変化）
### Environmental（環境要因）
### Political（政治・規制）

## 技術革新・イノベーション動向
### 新興技術
### 技術成熟度
### 普及予測

## 市場・ビジネストレンド
### ビジネスモデル変化
### 市場構造変化
### 顧客行動変化

## 長期展望・将来予測
### 2025年予測
### 2030年予測
### 不確実性・シナリオ

## 機会・脅威分析
### 新たな機会
### 潜在的脅威
### 対応必要性

## 推奨戦略・アクション
1. [具体的なアクション1]
2. [具体的なアクション2]
3. [具体的なアクション3]

## モニタリング指標
### 短期指標（6ヶ月-1年）
### 中期指標（1-3年）
### 長期指標（3年以上）

---
**調査実行日**: YYYY-MM-DD  
**調査時間**: X分  
**使用モデル**: Gemini（高速要約・パターン認識に最適化）  
**検索実行回数**: X回  
**分析トレンド数**: X個  
**品質スコア**: XX/100
```

### ステップ10: JSON出力（同時生成）
同名のJSONファイルも生成し、以下の構造化データを含める：
- report_type: "trend_analysis"
- target_domain: "対象領域名"
- trends: [{トレンドデータ配列}]
- steep_analysis: {STEEP分析データ}
- maturity_assessment: {技術成熟度データ}
- impact_timeline: {影響時期データ}
- opportunities_threats: {機会・脅威データ}
- predictions: {将来予測データ}
- sources: [{ソース情報配列}]
- execution_metadata: {実行統計}

### ステップ11: ファイル出力・完了報告
以下に保存：
- MD: Flow/YYYYMM/YYYY-MM-DD/[案件名]/draft_trend_analysis.md
- JSON: Flow/YYYYMM/YYYY-MM-DD/[案件名]/draft_trend_analysis.json

完了報告：
- 実行時間、ファイルパス、分析トレンド数
- 最重要トレンドのサマリー
- 推奨アクションの要点
- モニタリング指標の提案

## エラー処理
- トレンド情報不足時：類似領域での代替分析
- 将来予測困難時：複数シナリオでの分析
- web_search失敗時：代替キーワードで再試行
- 専門情報不足時：一般的トレンドでの補完
- 予算超過時：主要トレンドに絞った縮退運転

## 品質基準
- 実行時間：3分以内
- 情報源数：5-8個
- 主要トレンド：最低5個
- 分析フレームワーク：STEEP分析必須
- 時間軸：短期・中期・長期の3段階
- 予測精度：複数ソースでの整合性確認
- アクション項目：3-5個
- エビデンス網羅率：75%以上

## 特別な分析手法
- **トレンド収束分析**: 複数トレンドの相互作用・統合
- **弱いシグナル検出**: 初期段階の変化兆候の発見
- **シナリオプランニング**: 複数の将来シナリオ構築
- **ワイルドカード分析**: 低確率・高インパクト事象
- **トレンドライフサイクル**: トレンドの発生・成長・衰退分析
- **クロストレンド分析**: 異なる領域のトレンド相互影響