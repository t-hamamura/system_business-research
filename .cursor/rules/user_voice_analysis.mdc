# ユーザーボイス分析ルール（v2.0: 安全機能強化版）

## 安全なファイル名変換関数
```python
import re
import unicodedata

def safe_filename(text, max_length=80):
    """
    ファイルシステムで安全な名前に変換
    """
    # NFKC正規化（全角→半角変換含む）
    text = unicodedata.normalize('NFKC', text)
    
    # 英数字、ひらがな、カタカナ、漢字、ハイフン、アンダースコアのみ許可
    safe_text = re.sub(r'[^\w\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF\-]', '_', text)
    
    # 連続するアンダースコアを1つに
    safe_text = re.sub(r'_+', '_', safe_text)
    
    # 先頭末尾のアンダースコア削除
    safe_text = safe_text.strip('_')
    
    # 長さ制限
    if len(safe_text) > max_length:
        safe_text = safe_text[:max_length]
    
    # 空文字列の場合はデフォルト値
    return safe_text or "unknown"

# 使用例: 
# target_name = "ChatGPT/競合分析？（2025年版）"
# safe_name = safe_filename(target_name)  # "ChatGPT_競合分析_2025年版"
```

## トリガー条件
「ユーザー調査」「ユーザーボイス」「口コミ調査」「レビュー分析」のいずれかが入力された場合

## 実行手順

### ステップ1: 対象確認
- ユーザーに調査対象の製品・サービス・ブランドを確認
- 例: 「どちらの製品・サービスのユーザーボイス分析でしょうか？（例：電動歯ブラシ、LINEマーケティングツール）」
- 調査範囲の確認（期間、プラットフォーム、地域等）

### ステップ2: 日時フォルダ作成
現在日時を取得し、適切なフォルダ構造を作成：
```
Flow/YYYYMM/YYYY-MM-DD/[案件名]/
```

### ステップ3: 情報収集（7回のweb_search）
以下の順序で情報収集を実行：

#### 第1段階：並列基本検索（3本同時）
1. **基本レビュー**: "[対象] レビュー 評価 口コミ 最新"
2. **SNS言及**: "[対象] SNS 評判 感想 最新"
3. **Q&A・フォーラム**: "[対象] 質問 相談 Yahoo知恵袋 最新"

#### 第2段階：詳細分析（4本順次）
4. **Amazonレビュー**: "[対象] Amazon レビュー 評価 最新"
5. **価格.com等**: "[対象] 価格.com 比較サイト レビュー"
6. **YouTubeコメント**: "[対象] YouTube コメント 動画"
7. **専門サイト**: "[対象] 専門サイト レビュー 評価"

### ステップ4: 感情分析・カテゴライズ
収集した情報を以下の観点で分析：
- **感情分析**: ポジティブ・ネガティブ・ニュートラルの分類
- **テーマ分類**: 品質、価格、機能、サポート、使いやすさ等
- **重要度評価**: 言及頻度・影響度による重み付け
- **時系列変化**: 評価の変化トレンド
- **セグメント分析**: 年代・性別・使用用途による違い

### ステップ5: ペルソナ分析
ユーザーボイスから推定される：
- **典型的ユーザープロファイル**
- **利用シーン・目的**
- **期待値・ニーズ**
- **課題・不満点**
- **購入決定要因**

### ステップ6: 競合比較分析
可能な範囲で：
- **競合製品との比較言及**
- **乗り換え理由・選択理由**
- **相対的な評価ポジション**

### ステップ7: 信頼度評価
各情報源について：
- 発行日の確認（直近3ヶ月以内を優先）
- プラットフォームの信頼性評価
- レビュー数・投稿者の信頼性
- やらせレビューの可能性評価
- 引用抜粋の作成（25語以内）

### ステップ8: レポート生成
templates/user_voice_analysis_template.mdを基に以下の構造でレポート作成：

```
# ユーザーボイス分析レポート：[対象製品/サービス名]

## 情報品質サマリー
**情報源数**: X個 | **平均発行年**: YYYY.M | **信頼度分布**: A級X個・B級X個・C級X個

## エグゼクティブサマリー
[2-3行での要約]

## 主要ファインディング
- [重要な発見事項1]
- [重要な発見事項2]
- [重要な発見事項3]

## 全体的センチメント分析
### 感情分布
### 評価トレンド

## テーマ別分析
### 品質・性能
### 価格・コストパフォーマンス
### 使いやすさ・機能性
### サポート・アフターサービス

## 主要な評価ポイント
### 高評価要因
### 低評価・改善要求

## ユーザーペルソナ分析
### 典型的ユーザープロファイル
### 利用シーン・目的
### 購入決定要因

## 競合比較での言及
### 競合との比較評価
### 選択理由・乗り換え理由

## 時系列変化分析
### 評価の変化傾向
### 新機能・改善への反応

## 改善提案・機会
### 優先改善事項
### 新機能・サービスの機会

## 推奨アクション
1. [具体的なアクション1]
2. [具体的なアクション2]
3. [具体的なアクション3]

## エビデンス一覧（自動生成）
| 主張ID | 出典名 | URL | 発行日 | 取得日 | 抜粋(<=25語) | 信頼度(A/B/C) |

## 本調査の制約・限界事項
[制約がある場合のみ表示]

## 情報ソース詳細

---
**調査実行日**: YYYY-MM-DD  
**調査時間**: X分  
**使用モデル**: Claude（感情分析に最適化）  
**検索実行回数**: X回  
**情報源数**: X個  
**分析レビュー数**: 概算X件  
**品質スコア**: XX/100
```

### ステップ9: JSON出力（同時生成）
同名のJSONファイルも生成し、以下の構造化データを含める：
- report_type: "user_voice_analysis"
- target: "対象製品/サービス名"
- sentiment_distribution: {ポジティブ、ネガティブ、ニュートラルの比率}
- themes: [{テーマ別分析データ}]
- personas: [{ペルソナデータ}]
- timeline_analysis: {時系列変化データ}
- competitive_mentions: [{競合比較データ}]
- sources: [{ソース情報配列}]
- execution_metadata: {実行統計}

### ステップ10: ファイル出力
以下に保存：
- MD: Flow/YYYYMM/YYYY-MM-DD/[案件名]/draft_user_voice_analysis.md
- JSON: Flow/YYYYMM/YYYY-MM-DD/[案件名]/draft_user_voice_analysis.json

### ステップ11: 完了報告
- 実行時間の報告
- 生成されたファイルパスの表示
- 分析対象レビュー数の概算報告
- センチメント分布のサマリー
- 主要な改善提案ポイント
- 「確定反映して」で確定版への移行が可能な旨を案内

## エラー処理
- レビューデータ不足時：関連キーワードでの補完検索
- プラットフォーム制限時：代替サイトでの情報収集
- web_search失敗時：代替キーワードで再試行
- 感情分析困難時：定性的分析での補完
- 予算超過時：主要プラットフォームに絞った縮退運転

## 情報源記載ルール
- 必ず「サイト名」「ページタイトル」「ページURL」の3点セットで記載
- サイト名例: "ITmedia", "日経新聞", "PR TIMES"
- ページタイトル例: "AI市場は2025年に3兆円規模に成長予測"
- ページURL: 完全なhttps://で始まるURL

## 既存案件の場合の特別処理
- 既存ファイルが存在する場合は差分更新モードで実行
- 新旧情報を明確に区別して記載
- 更新理由・更新内容を「更新履歴」セクションに記載
- 古い情報は削除せず「※[年月]時点の情報」として保持

## 品質基準
- 実行時間：4分以内
- 情報源数：7-12個
- 分析プラットフォーム：最低5種類
- 感情分析精度：明確な分類80%以上
- テーマ分類：最低5カテゴリ
- ペルソナ数：2-3種類
- アクション項目：3-5個
- エビデンス網羅率：75%以上

## 特別な分析手法
- **感情スコアリング**: 定量的な感情強度測定
- **キーワード頻度分析**: 重要キーワードの出現頻度
- **競合比較マトリックス**: 複数製品での評価比較
- **セグメント別分析**: 年代・性別・用途での差分
- **改善優先度マトリックス**: インパクト×実現性での優先付け
- **NPS推定**: 推奨度の推定分析